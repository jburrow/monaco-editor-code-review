!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([,function(e,t,n){"use strict";n.r(t),n.d(t,"v1",(function(){return h})),n.d(t,"v3",(function(){return E})),n.d(t,"v4",(function(){return I})),n.d(t,"v5",(function(){return N}));var o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),r=new Uint8Array(16);function i(){if(!o)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o(r)}for(var a=[],d=0;d<256;++d)a.push((d+256).toString(16).substr(1));var s,m,c=function(e,t){var n=t||0;return(a[e[n+0]]+a[e[n+1]]+a[e[n+2]]+a[e[n+3]]+"-"+a[e[n+4]]+a[e[n+5]]+"-"+a[e[n+6]]+a[e[n+7]]+"-"+a[e[n+8]]+a[e[n+9]]+"-"+a[e[n+10]]+a[e[n+11]]+a[e[n+12]]+a[e[n+13]]+a[e[n+14]]+a[e[n+15]]).toLowerCase()},l=0,u=0;var h=function(e,t,n){var o=t&&n||0,r=t||new Array(16),a=(e=e||{}).node||s,d=void 0!==e.clockseq?e.clockseq:m;if(null==a||null==d){var h=e.random||(e.rng||i)();null==a&&(a=s=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==d&&(d=m=16383&(h[6]<<8|h[7]))}var f=void 0!==e.msecs?e.msecs:Date.now(),v=void 0!==e.nsecs?e.nsecs:u+1,g=f-l+(v-u)/1e4;if(g<0&&void 0===e.clockseq&&(d=d+1&16383),(g<0||f>l)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");l=f,u=v,m=d;var p=(1e4*(268435455&(f+=122192928e5))+v)%4294967296;r[o++]=p>>>24&255,r[o++]=p>>>16&255,r[o++]=p>>>8&255,r[o++]=255&p;var C=f/4294967296*1e4&268435455;r[o++]=C>>>8&255,r[o++]=255&C,r[o++]=C>>>24&15|16,r[o++]=C>>>16&255,r[o++]=d>>>8|128,r[o++]=255&d;for(var b=0;b<6;++b)r[o+b]=a[b];return t||c(r)};var f=function(e,t,n){function o(e,o,r,i){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof o&&(o=function(e){var t=[];return e.replace(/[a-fA-F0-9]{2}/g,(function(e){t.push(parseInt(e,16))})),t}(o)),!Array.isArray(e))throw TypeError("value must be an array of bytes");if(!Array.isArray(o)||16!==o.length)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var a=n(o.concat(e));if(a[6]=15&a[6]|t,a[8]=63&a[8]|128,r){i=i||0;for(var d=0;d<16;++d)r[i+d]=a[d];return r}return c(a)}try{o.name=e}catch(e){}return o.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",o.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",o};function v(e){return 14+(e+64>>>9<<4)+1}function g(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function p(e,t,n,o,r,i){return g((a=g(g(t,e),g(o,i)))<<(d=r)|a>>>32-d,n);var a,d}function C(e,t,n,o,r,i,a){return p(t&n|~t&o,e,t,r,i,a)}function b(e,t,n,o,r,i,a){return p(t&o|n&~o,e,t,r,i,a)}function y(e,t,n,o,r,i,a){return p(t^n^o,e,t,r,i,a)}function w(e,t,n,o,r,i,a){return p(n^(t|~o),e,t,r,i,a)}var E=f("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){for(var t=[],n=32*e.length,o=0;o<n;o+=8){var r=e[o>>5]>>>o%32&255,i=parseInt("0123456789abcdef".charAt(r>>>4&15)+"0123456789abcdef".charAt(15&r),16);t.push(i)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[v(t)-1]=t;for(var n=1732584193,o=-271733879,r=-1732584194,i=271733878,a=0;a<e.length;a+=16){var d=n,s=o,m=r,c=i;n=C(n,o,r,i,e[a],7,-680876936),i=C(i,n,o,r,e[a+1],12,-389564586),r=C(r,i,n,o,e[a+2],17,606105819),o=C(o,r,i,n,e[a+3],22,-1044525330),n=C(n,o,r,i,e[a+4],7,-176418897),i=C(i,n,o,r,e[a+5],12,1200080426),r=C(r,i,n,o,e[a+6],17,-1473231341),o=C(o,r,i,n,e[a+7],22,-45705983),n=C(n,o,r,i,e[a+8],7,1770035416),i=C(i,n,o,r,e[a+9],12,-1958414417),r=C(r,i,n,o,e[a+10],17,-42063),o=C(o,r,i,n,e[a+11],22,-1990404162),n=C(n,o,r,i,e[a+12],7,1804603682),i=C(i,n,o,r,e[a+13],12,-40341101),r=C(r,i,n,o,e[a+14],17,-1502002290),o=C(o,r,i,n,e[a+15],22,1236535329),n=b(n,o,r,i,e[a+1],5,-165796510),i=b(i,n,o,r,e[a+6],9,-1069501632),r=b(r,i,n,o,e[a+11],14,643717713),o=b(o,r,i,n,e[a],20,-373897302),n=b(n,o,r,i,e[a+5],5,-701558691),i=b(i,n,o,r,e[a+10],9,38016083),r=b(r,i,n,o,e[a+15],14,-660478335),o=b(o,r,i,n,e[a+4],20,-405537848),n=b(n,o,r,i,e[a+9],5,568446438),i=b(i,n,o,r,e[a+14],9,-1019803690),r=b(r,i,n,o,e[a+3],14,-187363961),o=b(o,r,i,n,e[a+8],20,1163531501),n=b(n,o,r,i,e[a+13],5,-1444681467),i=b(i,n,o,r,e[a+2],9,-51403784),r=b(r,i,n,o,e[a+7],14,1735328473),o=b(o,r,i,n,e[a+12],20,-1926607734),n=y(n,o,r,i,e[a+5],4,-378558),i=y(i,n,o,r,e[a+8],11,-2022574463),r=y(r,i,n,o,e[a+11],16,1839030562),o=y(o,r,i,n,e[a+14],23,-35309556),n=y(n,o,r,i,e[a+1],4,-1530992060),i=y(i,n,o,r,e[a+4],11,1272893353),r=y(r,i,n,o,e[a+7],16,-155497632),o=y(o,r,i,n,e[a+10],23,-1094730640),n=y(n,o,r,i,e[a+13],4,681279174),i=y(i,n,o,r,e[a],11,-358537222),r=y(r,i,n,o,e[a+3],16,-722521979),o=y(o,r,i,n,e[a+6],23,76029189),n=y(n,o,r,i,e[a+9],4,-640364487),i=y(i,n,o,r,e[a+12],11,-421815835),r=y(r,i,n,o,e[a+15],16,530742520),o=y(o,r,i,n,e[a+2],23,-995338651),n=w(n,o,r,i,e[a],6,-198630844),i=w(i,n,o,r,e[a+7],10,1126891415),r=w(r,i,n,o,e[a+14],15,-1416354905),o=w(o,r,i,n,e[a+5],21,-57434055),n=w(n,o,r,i,e[a+12],6,1700485571),i=w(i,n,o,r,e[a+3],10,-1894986606),r=w(r,i,n,o,e[a+10],15,-1051523),o=w(o,r,i,n,e[a+1],21,-2054922799),n=w(n,o,r,i,e[a+8],6,1873313359),i=w(i,n,o,r,e[a+15],10,-30611744),r=w(r,i,n,o,e[a+6],15,-1560198380),o=w(o,r,i,n,e[a+13],21,1309151649),n=w(n,o,r,i,e[a+4],6,-145523070),i=w(i,n,o,r,e[a+11],10,-1120210379),r=w(r,i,n,o,e[a+2],15,718787259),o=w(o,r,i,n,e[a+9],21,-343485551),n=g(n,d),o=g(o,s),r=g(r,m),i=g(i,c)}return[n,o,r,i]}(function(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(v(t)),o=0;o<t;o+=8)n[o>>5]|=(255&e[o/8])<<o%32;return n}(e),8*e.length))}));var I=function(e,t,n){var o=(e=e||{}).random||(e.rng||i)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){n=n||0;for(var r=0;r<16;++r)t[n+r]=o[r];return t}return c(o)};function M(e,t,n,o){switch(e){case 0:return t&n^~t&o;case 1:return t^n^o;case 2:return t&n^t&o^n&o;case 3:return t^n^o}}function x(e,t){return e<<t|e>>>32-t}var N=f("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var o=unescape(encodeURIComponent(e));e=[];for(var r=0;r<o.length;++r)e.push(o.charCodeAt(r))}e.push(128);for(var i=e.length/4+2,a=Math.ceil(i/16),d=new Array(a),s=0;s<a;++s){for(var m=new Uint32Array(16),c=0;c<16;++c)m[c]=e[64*s+4*c]<<24|e[64*s+4*c+1]<<16|e[64*s+4*c+2]<<8|e[64*s+4*c+3];d[s]=m}d[a-1][14]=8*(e.length-1)/Math.pow(2,32),d[a-1][14]=Math.floor(d[a-1][14]),d[a-1][15]=8*(e.length-1)&4294967295;for(var l=0;l<a;++l){for(var u=new Uint32Array(80),h=0;h<16;++h)u[h]=d[l][h];for(var f=16;f<80;++f)u[f]=x(u[f-3]^u[f-8]^u[f-14]^u[f-16],1);for(var v=n[0],g=n[1],p=n[2],C=n[3],b=n[4],y=0;y<80;++y){var w=Math.floor(y/20),E=x(v,5)+M(w,g,p,C)+b+t[w]+u[y]>>>0;b=C,C=p,p=x(g,30)>>>0,g=v,v=E}n[0]=n[0]+v>>>0,n[1]=n[1]+g>>>0,n[2]=n[2]+p>>>0,n[3]=n[3]+C>>>0,n[4]=n[4]+b>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]}))},function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ReviewManager=t.createReviewManager=t.EditorMode=t.reduceComments=void 0;var r=n(3);Object.defineProperty(t,"reduceComments",{enumerable:!0,get:function(){return r.reduceComments}});var i,a,d=n(1),s=window;!function(e){e[e.next=1]="next",e[e.prev=2]="prev"}(i||(i={})),function(e){e[e.insertComment=1]="insertComment",e[e.editComment=2]="editComment",e[e.toolbar=3]="toolbar"}(a=t.EditorMode||(t.EditorMode={})),t.createReviewManager=function(e,t,n,o,r,i){var a=new c(e,t,o,r,i);return a.load(n||[]),a};var m={commentIndent:20,commentIndentOffset:20,editButtonAddText:"Reply",editButtonEditText:"Edit",editButtonEnableEdit:!0,editButtonEnableRemove:!0,editButtonOffset:"-10px",editButtonRemoveText:"Remove",formatDate:null,readOnly:!1,rulerMarkerColor:"darkorange",rulerMarkerDarkColor:"darkorange",showAddCommentGlyph:!0,showInRuler:!0,verticalOffset:0},c=function(){function e(e,t,n,r,i){var d=this;this.currentUser=t,this.editor=e,this.activeComment=null,this.widgetInlineToolbar=null,this.widgetInlineCommentEditor=null,this.onChange=n,this.editorMode=a.toolbar,this.config=o(o({},m),r||{}),this.currentLineDecorations=[],this.currentCommentDecorations=[],this.currentLineDecorationLineNumber=null,this.events=[],this.store={comments:{}},this.renderStore={},this.verbose=i,this.editorConfig=this.editor.getRawOptions(),this.editor.onDidChangeConfiguration((function(){return d.editorConfig=d.editor.getRawOptions()})),this.editor.onMouseDown(this.handleMouseDown.bind(this)),this.canAddCondition=this.editor.createContextKey("add-context-key",!this.config.readOnly),this.inlineToolbarElements=this.createInlineToolbarWidget(),this.editorElements=this.createInlineEditorWidget(),this.addActions(),this.config.showAddCommentGlyph&&this.editor.onMouseMove(this.handleMouseMove.bind(this))}return e.prototype.setReadOnlyMode=function(e){this.config.readOnly=e,this.canAddCondition.set(e),this.renderAddCommentLineDecoration(null)},e.prototype.load=function(e){var t=r.reduceComments(e);this.loadFromStore(t,e)},e.prototype.loadFromStore=function(e,t){var n=this;this.editor.changeViewZones((function(o){for(var r=0,i=Object.values(n.store.comments);r<i.length;r++){var a=i[r],d=n.getRenderState(a.comment.id);d&&null!==d.viewZoneId&&o.removeZone(d.viewZoneId)}n.events=t,n.store=e,n.store.deletedCommentIds=null,n.store.dirtyCommentIds=null,n.renderStore={},n.refreshComments(),n.verbose&&console.debug("Events Loaded:",t.length,"Review Comments:",Object.values(n.store.comments).length)}))},e.prototype.getThemedColor=function(e){var t=this.editor._themeService.getTheme(),n=t.getColor(e);return n||(n={dark:{"button.background":"#0e639c","button.foreground":"#ffffff"},light:{"button.background":"#007acc","button.foreground":"#ffffff"}}[t.themeName.indexOf("dark")>-1?"dark":"light"][e]),n},e.prototype.createInlineEditButtonsElement=function(){var e=this,t=document.createElement("div");t.className="editButtonsContainer",t.style.marginLeft=this.config.editButtonOffset;var n=document.createElement("span");n.innerText=this.config.editButtonAddText,n.className="editButton add",n.setAttribute("ReviewManagerControl",""),n.onclick=function(){return e.setEditorMode(a.insertComment,"add-comment")},t.appendChild(n);var o=null,r=null,i=null;return this.config.editButtonEnableRemove&&((i=document.createElement("div")).innerText=" ",t.appendChild(i),(o=document.createElement("span")).setAttribute("ReviewManagerControl",""),o.innerText=this.config.editButtonRemoveText,o.className="editButton remove",o.onclick=function(){return e.activeComment&&e.removeComment(e.activeComment.id)},t.appendChild(o)),this.config.editButtonEnableEdit&&((i=document.createElement("div")).innerText=" ",t.appendChild(i),(r=document.createElement("span")).setAttribute("ReviewManagerControl",""),r.innerText=this.config.editButtonEditText,r.className="editButton edit",r.onclick=function(){return e.setEditorMode(a.editComment,"edit")},t.appendChild(r)),{root:t,add:n,remove:o,edit:r}},e.prototype.handleCancel=function(){this.setEditorMode(a.toolbar,"cancel"),this.editor.focus()},e.prototype.handleAddComment=function(){var e=this.activeComment?this.activeComment.lineNumber:this.editor.getSelection().endLineNumber,t=this.editorElements.textarea.value,n=this.activeComment?null:this.editor.getSelection();this.addComment(e,t,n),this.setEditorMode(a.toolbar,"add-comment-1"),this.editor.focus()},e.prototype.handleTextAreaKeyDown=function(e){"Escape"===e.code?(this.handleCancel(),e.preventDefault(),console.info("preventDefault: Escape Key")):"Enter"===e.code&&e.ctrlKey&&(this.handleAddComment(),e.preventDefault(),console.info("preventDefault: ctrl+Enter"))},e.prototype.createInlineEditorElement=function(){var e=document.createElement("div");e.className="reviewCommentEditor";var t=document.createElement("textarea");t.setAttribute("ReviewManagerControl",""),t.className="reviewCommentEditor text",t.innerText="",t.style.resize="none",t.style.width="100%",t.name="text",t.onkeydown=this.handleTextAreaKeyDown.bind(this);var n=document.createElement("button");n.setAttribute("ReviewManagerControl",""),n.className="reviewCommentEditor save",n.style.fontFamily="Consolas",n.innerText="Add Comment",n.onclick=this.handleAddComment.bind(this);var o=document.createElement("button");return o.setAttribute("ReviewManagerControl",""),o.className="reviewCommentEditor cancel",o.innerText="Cancel",o.onclick=this.handleCancel.bind(this),e.appendChild(t),e.appendChild(o),e.appendChild(n),{root:e,confirm:n,cancel:o,textarea:t}},e.prototype.createInlineToolbarWidget=function(){var e=this.createInlineEditButtonsElement(),t=this;return this.widgetInlineToolbar={allowEditorOverflow:!0,getId:function(){return"widgetInlineToolbar"},getDomNode:function(){return e.root},getPosition:function(){if(t.activeComment&&t.editorMode==a.toolbar&&!t.config.readOnly)return{position:{lineNumber:t.activeComment.lineNumber,column:1},preference:[2]}}},this.editor.addContentWidget(this.widgetInlineToolbar),e},e.prototype.createInlineEditorWidget=function(){var e=this,t=this.createInlineEditorElement();return this.widgetInlineCommentEditor={allowEditorOverflow:!0,getId:function(){return"widgetInlineEditor"},getDomNode:function(){return console.log("getDomNode"),t.root},getPosition:function(){if(e.editorMode==a.insertComment||e.editorMode==a.editComment){var t=e.editor.getPosition();return{position:{lineNumber:e.activeComment?e.activeComment.lineNumber:t.lineNumber+1,column:t.column},preference:[0]}}}},this.editor.addContentWidget(this.widgetInlineCommentEditor),t},e.prototype.setActiveComment=function(e){var t=this;this.verbose&&console.debug("setActiveComment",e);var n=[];!this.activeComment||e&&this.activeComment.lineNumber===e.lineNumber||n.push(this.activeComment.lineNumber),e&&n.push(e.lineNumber),this.activeComment=e,n.length>0&&this.filterAndMapComments(n,(function(e){t.renderStore[e.id].renderStatus=r.ReviewCommentRenderState.dirty}))},e.prototype.filterAndMapComments=function(e,t){for(var n=0,o=Object.values(this.store.comments);n<o.length;n++){var r=o[n];e.indexOf(r.comment.lineNumber)>-1&&t(r.comment)}},e.prototype.handleMouseMove=function(e){e.target&&e.target.position&&e.target.position.lineNumber&&(this.currentLineDecorationLineNumber=e.target.position.lineNumber,this.renderAddCommentLineDecoration(!0===this.config.readOnly?null:this.currentLineDecorationLineNumber))},e.prototype.renderAddCommentLineDecoration=function(e){var t=e?[{range:new s.monaco.Range(e,0,e,0),options:{marginClassName:"activeLineMarginClass",zIndex:100}}]:[];this.currentLineDecorations=this.editor.deltaDecorations(this.currentLineDecorations,t)},e.prototype.handleMouseDown=function(e){if(e.target.element.className&&e.target.element.className.indexOf("activeLineMarginClass")>-1)this.editor.setPosition({lineNumber:this.currentLineDecorationLineNumber,column:1}),this.setEditorMode(a.insertComment,"mouse-down-1");else if(!e.target.element.hasAttribute("ReviewManagerControl")){var t=null;if(e.target.detail&&null!==e.target.detail.viewZoneId)for(var n=0,o=Object.values(this.store.comments).map((function(e){return e.comment}));n<o.length;n++){var r=o[n];if(this.getRenderState(r.id).viewZoneId==e.target.detail.viewZoneId){t=r;break}}this.setActiveComment(t),this.refreshComments(),this.setEditorMode(a.toolbar,"mouse-down-2")}},e.prototype.calculateMarginTopOffset=function(e){var t=0,n=0,o=this.editorConfig.lineHeight;if(this.activeComment){for(var r=0,i=this.iterateComments();r<i.length;r++){var a=i[r];if(a.state.comment.lineNumber!==this.activeComment.lineNumber||a.state.comment==this.activeComment&&!e||(t+=this.calculateNumberOfLines(a.state.comment.text)),a.state.comment==this.activeComment)break}n=t*o}return n+this.config.verticalOffset},e.prototype.layoutInlineToolbar=function(){var e=this;if(this.inlineToolbarElements.root.style.backgroundColor=this.getThemedColor("editor.background"),this.inlineToolbarElements.root.style.marginTop=this.calculateMarginTopOffset(!1)+"px",this.inlineToolbarElements.remove){var t=this.activeComment&&this.iterateComments((function(t){return t.comment.id===e.activeComment.id})).length>1,n=this.activeComment&&this.activeComment.author===this.currentUser;this.inlineToolbarElements.remove.style.display=t?"none":"",this.inlineToolbarElements.edit.style.display=t||!n?"none":""}this.editor.layoutContentWidget(this.widgetInlineToolbar)},e.prototype.layoutInlineCommentEditor=function(){var e=this;[this.editorElements.root,this.editorElements.textarea].forEach((function(t){t.style.backgroundColor=e.getThemedColor("editor.background"),t.style.color=e.getThemedColor("editor.foreground")})),[this.editorElements.confirm,this.editorElements.cancel].forEach((function(t){t.style.backgroundColor=e.getThemedColor("button.background"),t.style.color=e.getThemedColor("button.foreground")})),this.editorElements.confirm.innerText=this.editorMode===a.insertComment?"Add Comment":"Edit Comment",console.log("layout",this.editorElements.root),this.editor.layoutContentWidget(this.widgetInlineCommentEditor)},e.prototype.setEditorMode=function(e,t){var n=this;void 0===t&&(t=null),console.log("setEditorMode",t),this.editorMode=this.config.readOnly?a.toolbar:e,console.warn("setEditorMode",a[e],"Comment:",this.activeComment,"ReadOnly:",this.config.readOnly,"Result:",a[this.editorMode]),this.layoutInlineToolbar(),this.layoutInlineCommentEditor(),e!=a.insertComment&&e!=a.editComment||(e==a.insertComment?this.editorElements.textarea.value="":e==a.editComment&&(this.editorElements.textarea.value=this.activeComment?this.activeComment.text:""),setTimeout((function(){return n.editorElements.textarea.focus()}),100))},e.prototype.getDateTimeNow=function(){return new Date},e.prototype.recurseComments=function(e,t,n,o){for(var r=Object.values(e).filter(t),i=function(t){var r=t.comment;delete e[r.id],o.push({depth:n,state:t}),a.recurseComments(e,(function(e){return e.comment.parentId===r.id}),n+1,o)},a=this,d=0,s=r;d<s.length;d++){i(s[d])}},e.prototype.iterateComments=function(e){e||(e=function(e){return!e.comment.parentId});var t=o({},this.store.comments),n=[];return this.recurseComments(t,e,0,n),n},e.prototype.removeComment=function(e){return this.addEvent({type:"delete",targetId:e})},e.prototype.addComment=function(e,t,n){var o=this.editorMode===a.editComment?{type:"edit",text:t,targetId:this.activeComment.id}:{type:"create",text:t,lineNumber:e,selection:n,targetId:this.activeComment&&this.activeComment.id};return this.addEvent(o)},e.prototype.addEvent=function(e){return e.createdBy=this.currentUser,e.createdAt=this.getDateTimeNow(),e.id=d.v4(),this.events.push(e),this.store=r.commentReducer(e,this.store),(this.activeComment&&!this.store.comments[this.activeComment.id]||this.activeComment&&this.activeComment.status===r.ReviewCommentStatus.deleted)&&this.setActiveComment(null),this.refreshComments(),this.layoutInlineToolbar(),this.onChange&&this.onChange(this.events),e},e.prototype.formatDate=function(e){return this.config.formatDate?this.config.formatDate(e):e instanceof Date?e.toISOString():e},e.prototype.createElement=function(e,t,n){void 0===n&&(n=null);var o=document.createElement(n||"span");return o.className=t,o.innerText=e,o},e.prototype.getRenderState=function(e){return this.renderStore[e]||(this.renderStore[e]={viewZoneId:null,renderStatus:null}),this.renderStore[e]},e.prototype.refreshComments=function(){var e=this;this.editor.changeViewZones((function(t){for(var n,o={},i=0,a=Array.from(e.store.deletedCommentIds||[]);i<a.length;i++){var d=a[i],m=null===(n=e.renderStore[d])||void 0===n?void 0:n.viewZoneId;t.removeZone(m),e.verbose&&console.debug("Zone.Delete",m)}e.store.deletedCommentIds=null;for(var c=0,l=Array.from(e.store.dirtyCommentIds||[]);c<l.length;c++){d=l[c];e.getRenderState(d).renderStatus=r.ReviewCommentRenderState.dirty}e.store.dirtyCommentIds=null;for(var u=0,h=e.iterateComments();u<h.length;u++){var f=h[u],v=e.getRenderState(f.state.comment.id);if(v.renderStatus!==r.ReviewCommentRenderState.hidden){if(v.renderStatus===r.ReviewCommentRenderState.dirty&&(e.verbose&&console.debug("Zone.Dirty",f.state.comment.id),t.removeZone(v.viewZoneId),v.viewZoneId=null,v.renderStatus=r.ReviewCommentRenderState.normal),o[f.state.comment.lineNumber]||(o[f.state.comment.lineNumber]=f.state.comment.selection),null==v.viewZoneId){e.verbose&&console.debug("Zone.Create",f.state.comment.id);var g=e.activeComment==f.state.comment,p=e.createElement("","reviewComment "+(g?"active":" inactive"));p.style.marginLeft=e.config.commentIndent*(f.depth+1)+e.config.commentIndentOffset+"px",p.style.backgroundColor=e.getThemedColor("editor.selectionHighlightBackground"),p.appendChild(e.createElement((f.state.comment.author||" ")+" at ","reviewComment author")),p.appendChild(e.createElement(e.formatDate(f.state.comment.dt),"reviewComment dt")),f.state.history.length>1&&p.appendChild(e.createElement("(Edited "+(f.state.history.length-1)+" times)","reviewComment history")),p.appendChild(e.createElement(""+f.state.comment.text,"reviewComment text","div")),v.viewZoneId=t.addZone({afterLineNumber:f.state.comment.lineNumber,heightInLines:e.calculateNumberOfLines(f.state.comment.text),domNode:p,suppressMouseDown:!0})}}else e.verbose&&console.debug("Zone.Hidden",f.state.comment.id),t.removeZone(v.viewZoneId),v.viewZoneId=null}if(e.config.showInRuler){for(var C=[],b=0,y=Object.entries(o);b<y.length;b++){var w=y[b],E=w[0],I=w[1];C.push({range:new s.monaco.Range(E,0,E,0),options:{isWholeLine:!0,overviewRuler:{color:e.config.rulerMarkerColor,darkColor:e.config.rulerMarkerDarkColor,position:1}}}),I&&C.push({range:new s.monaco.Range(I.startLineNumber,I.startColumn,I.endLineNumber,I.endColumn),options:{className:"reviewComment selection"}})}e.currentCommentDecorations=e.editor.deltaDecorations(e.currentCommentDecorations,C)}}))},e.prototype.calculateNumberOfLines=function(e){return e?e.split(/\r*\n/).length+1:1},e.prototype.addActions=function(){var e=this;this.editor.addAction({id:"my-unique-id-add",label:"Add Comment",keybindings:[s.monaco.KeyMod.CtrlCmd|s.monaco.KeyCode.F10],precondition:"add-context-key",keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:0,run:function(){e.setEditorMode(a.insertComment,"add-comment-x")}}),this.editor.addAction({id:"my-unique-id-next",label:"Next Comment",keybindings:[s.monaco.KeyMod.CtrlCmd|s.monaco.KeyCode.F12],precondition:null,keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:.101,run:function(){e.navigateToComment(i.next)}}),this.editor.addAction({id:"my-unique-id-prev",label:"Prev Comment",keybindings:[s.monaco.KeyMod.CtrlCmd|s.monaco.KeyCode.F11],precondition:null,keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:.102,run:function(){e.navigateToComment(i.prev)}})},e.prototype.navigateToComment=function(e){var t=0;t=this.activeComment?this.activeComment.lineNumber:this.editor.getPosition().lineNumber;var n=Object.values(this.store.comments).map((function(e){return e.comment})).filter((function(n){if(!n.parentId){if(e===i.next)return n.lineNumber>t;if(e===i.prev)return n.lineNumber<t}}));if(n.length){n.sort((function(t,n){return e===i.next?t.lineNumber-n.lineNumber:e===i.prev?n.lineNumber-t.lineNumber:void 0}));var o=n[0];this.setActiveComment(o),this.refreshComments(),this.layoutInlineToolbar(),this.editor.revealLineInCenter(o.lineNumber)}},e}();t.ReviewManager=c},function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.reduceComments=t.ReviewCommentStatus=t.ReviewCommentRenderState=t.ReviewCommentState=t.commentReducer=void 0;var r=n(1);function i(e,t){var n=new Set,r=new Set,i=new Set,s=o({},t.comments);switch(e.type){case"edit":var m=s[e.targetId];if(!m)break;var c={comment:o(o({},m.comment),{author:e.createdBy,dt:e.createdAt,text:e.text}),history:m.history.concat(m.comment)};n.add(c.comment.lineNumber),console.debug("edit",e),s[e.targetId]=c;break;case"delete":var l=s[e.targetId];if(!l)break;delete s[e.targetId],r.add(l.comment.id),n.add(l.comment.lineNumber),console.debug("delete",e);break;case"create":s[e.id]||(s[e.id]=new d({author:e.createdBy,dt:e.createdAt,id:e.id,lineNumber:e.lineNumber,selection:e.selection,text:e.text,parentId:e.targetId,status:a.active}),console.debug("insert",e),n.add(e.lineNumber))}if(n.size)for(var u=0,h=Object.values(t.comments);u<h.length;u++){var f=h[u];n.has(f.comment.lineNumber)&&i.add(f.comment.id)}return{comments:s,dirtyCommentIds:i,deletedCommentIds:r}}t.commentReducer=i;var a,d=function(e){this.comment=e,this.history=[e]};t.ReviewCommentState=d,function(e){e[e.dirty=1]="dirty",e[e.hidden=2]="hidden",e[e.normal=3]="normal"}(t.ReviewCommentRenderState||(t.ReviewCommentRenderState={})),function(e){e[e.active=1]="active",e[e.deleted=2]="deleted",e[e.edit=3]="edit"}(a=t.ReviewCommentStatus||(t.ReviewCommentStatus={})),t.reduceComments=function(e,t){void 0===t&&(t=null),t=t||{comments:{}};for(var n=0,o=e;n<o.length;n++){var a=o[n];a.id||(a.id=r.v4()),t=i(a,t)}return t}}]);
//# sourceMappingURL=index-commonjs-es5.js.map