!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([,function(e,t,n){var o=n(4),i=n(5);e.exports=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||o)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var m=0;m<16;++m)t[r+m]=a[m];return t||i(a)}},function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(3);t.reduceComments=i.reduceComments;var r,a,m=n(1),s=window;!function(e){e[e.next=1]="next",e[e.prev=2]="prev"}(r||(r={})),function(e){e[e.insertComment=1]="insertComment",e[e.editComment=2]="editComment",e[e.toolbar=3]="toolbar"}(a=t.EditorMode||(t.EditorMode={})),t.createReviewManager=function(e,t,n,o,i,r){var a=new l(e,t,o,i,r);return a.load(n||[]),a};var d={commentIndent:20,commentIndentOffset:20,editButtonAddText:"Reply",editButtonEditText:"Edit",editButtonEnableEdit:!0,editButtonEnableRemove:!0,editButtonOffset:"-10px",editButtonRemoveText:"Remove",formatDate:null,readOnly:!1,rulerMarkerColor:"darkorange",rulerMarkerDarkColor:"darkorange",showAddCommentGlyph:!0,showInRuler:!0,verticalOffset:0},l=function(){function e(e,t,n,i,r){var m=this;this.currentUser=t,this.editor=e,this.activeComment=null,this.widgetInlineToolbar=null,this.widgetInlineCommentEditor=null,this.onChange=n,this.editorMode=a.toolbar,this.config=o(o({},d),i||{}),this.currentLineDecorations=[],this.currentCommentDecorations=[],this.currentLineDecorationLineNumber=null,this.events=[],this.store={comments:{}},this.renderStore={},this.verbose=r,this.editorConfig=this.editor.getRawOptions(),this.editor.onDidChangeConfiguration((function(){return m.editorConfig=m.editor.getRawOptions()})),this.editor.onMouseDown(this.handleMouseDown.bind(this)),this.canAddCondition=this.editor.createContextKey("add-context-key",!this.config.readOnly),this.inlineToolbarElements=this.createInlineToolbarWidget(),this.editorElements=this.createInlineEditorWidget(),this.addActions(),this.config.showAddCommentGlyph&&this.editor.onMouseMove(this.handleMouseMove.bind(this))}return e.prototype.setReadOnlyMode=function(e){this.config.readOnly=e,this.canAddCondition.set(e),this.renderAddCommentLineDecoration(null)},e.prototype.load=function(e){var t=i.reduceComments(e);this.loadFromStore(t,e)},e.prototype.loadFromStore=function(e,t){var n=this;this.editor.changeViewZones((function(o){for(var i=0,r=Object.values(n.store.comments);i<r.length;i++){var a=r[i],m=n.getRenderState(a.comment.id);m&&null!==m.viewZoneId&&o.removeZone(m.viewZoneId)}n.events=t,n.store=e,n.store.deletedCommentIds=null,n.store.dirtyCommentIds=null,n.renderStore={},n.refreshComments(),n.verbose&&console.debug("Events Loaded:",t.length,"Review Comments:",Object.values(n.store.comments).length)}))},e.prototype.getThemedColor=function(e){var t=this.editor._themeService.getTheme(),n=t.getColor(e);return n||(n={dark:{"button.background":"#0e639c","button.foreground":"#ffffff"},light:{"button.background":"#007acc","button.foreground":"#ffffff"}}[t.themeName.indexOf("dark")>-1?"dark":"light"][e]),n},e.prototype.createInlineEditButtonsElement=function(){var e=this,t=document.createElement("div");t.className="editButtonsContainer",t.style.marginLeft=this.config.editButtonOffset;var n=document.createElement("span");n.innerText=this.config.editButtonAddText,n.className="editButton add",n.setAttribute("ReviewManagerControl",""),n.onclick=function(){return e.setEditorMode(a.insertComment)},t.appendChild(n);var o=null,i=null,r=null;return this.config.editButtonEnableRemove&&((r=document.createElement("div")).innerText=" ",t.appendChild(r),(o=document.createElement("span")).setAttribute("ReviewManagerControl",""),o.innerText=this.config.editButtonRemoveText,o.className="editButton remove",o.onclick=function(){return e.activeComment&&e.removeComment(e.activeComment.id)},t.appendChild(o)),this.config.editButtonEnableEdit&&((r=document.createElement("div")).innerText=" ",t.appendChild(r),(i=document.createElement("span")).setAttribute("ReviewManagerControl",""),i.innerText=this.config.editButtonEditText,i.className="editButton edit",i.onclick=function(){return e.setEditorMode(a.editComment)},t.appendChild(i)),{root:t,add:n,remove:o,edit:i}},e.prototype.handleCancel=function(){this.setEditorMode(a.toolbar),this.editor.focus()},e.prototype.handleAddComment=function(){var e=this.activeComment?this.activeComment.lineNumber:this.editor.getSelection().endLineNumber,t=this.editorElements.textarea.value,n=this.activeComment?null:this.editor.getSelection();this.addComment(e,t,n),this.setEditorMode(a.toolbar),this.editor.focus()},e.prototype.handleTextAreaKeyDown=function(e){"Escape"===e.code?(this.handleCancel(),e.preventDefault(),console.info("preventDefault: Escape Key")):"Enter"===e.code&&e.ctrlKey&&(this.handleAddComment(),e.preventDefault(),console.info("preventDefault: ctrl+Enter"))},e.prototype.createInlineEditorElement=function(){var e=document.createElement("span");e.className="reviewCommentEditor";var t=document.createElement("textarea");t.setAttribute("ReviewManagerControl",""),t.className="reviewCommentEditor text",t.innerText="",t.style.resize="none",t.name="text",t.onkeydown=this.handleTextAreaKeyDown.bind(this);var n=document.createElement("button");n.setAttribute("ReviewManagerControl",""),n.className="reviewCommentEditor save",n.style.fontFamily="Consolas",n.innerText="Add Comment",n.onclick=this.handleAddComment.bind(this);var o=document.createElement("button");return o.setAttribute("ReviewManagerControl",""),o.className="reviewCommentEditor cancel",o.innerText="Cancel",o.onclick=this.handleCancel.bind(this),e.appendChild(t),e.appendChild(o),e.appendChild(n),{root:e,confirm:n,cancel:o,textarea:t}},e.prototype.createInlineToolbarWidget=function(){var e=this.createInlineEditButtonsElement(),t=this;return this.widgetInlineToolbar={allowEditorOverflow:!0,getId:function(){return"widgetInlineToolbar"},getDomNode:function(){return e.root},getPosition:function(){if(t.activeComment&&t.editorMode==a.toolbar&&!t.config.readOnly)return{position:{lineNumber:t.activeComment.lineNumber,column:1},preference:[2]}}},this.editor.addContentWidget(this.widgetInlineToolbar),e},e.prototype.createInlineEditorWidget=function(){var e=this,t=this.createInlineEditorElement();return this.widgetInlineCommentEditor={allowEditorOverflow:!0,getId:function(){return"widgetInlineEditor"},getDomNode:function(){return t.root},getPosition:function(){if(e.editorMode==a.insertComment||e.editorMode==a.editComment)return{position:{lineNumber:e.activeComment?e.activeComment.lineNumber:e.editor.getPosition().lineNumber+1,column:1},preference:[2]}}},this.editor.addContentWidget(this.widgetInlineCommentEditor),t},e.prototype.setActiveComment=function(e){var t=this;this.verbose&&console.debug("setActiveComment",e);var n=[];!this.activeComment||e&&this.activeComment.lineNumber===e.lineNumber||n.push(this.activeComment.lineNumber),e&&n.push(e.lineNumber),this.activeComment=e,n.length>0&&this.filterAndMapComments(n,(function(e){t.renderStore[e.id].renderStatus=i.ReviewCommentRenderState.dirty}))},e.prototype.filterAndMapComments=function(e,t){for(var n=0,o=Object.values(this.store.comments);n<o.length;n++){var i=o[n];e.indexOf(i.comment.lineNumber)>-1&&t(i.comment)}},e.prototype.handleMouseMove=function(e){e.target&&e.target.position&&e.target.position.lineNumber&&(this.currentLineDecorationLineNumber=e.target.position.lineNumber,this.renderAddCommentLineDecoration(this.config.readOnly?null:this.currentLineDecorationLineNumber))},e.prototype.renderAddCommentLineDecoration=function(e){var t=e?[{range:new s.monaco.Range(e,0,e,0),options:{marginClassName:"activeLineMarginClass",zIndex:100}}]:[];this.currentLineDecorations=this.editor.deltaDecorations(this.currentLineDecorations,t)},e.prototype.handleMouseDown=function(e){if(e.target.element.className&&e.target.element.className.indexOf("activeLineMarginClass")>-1)this.editor.setPosition({lineNumber:this.currentLineDecorationLineNumber,column:1}),this.setEditorMode(a.insertComment);else if(!e.target.element.hasAttribute("ReviewManagerControl")){var t=null;if(e.target.detail&&null!==e.target.detail.viewZoneId)for(var n=0,o=Object.values(this.store.comments).map((function(e){return e.comment}));n<o.length;n++){var i=o[n];if(this.getRenderState(i.id).viewZoneId==e.target.detail.viewZoneId){t=i;break}}this.setActiveComment(t),this.refreshComments(),this.setEditorMode(a.toolbar)}},e.prototype.calculateMarginTopOffset=function(e){var t=0,n=0,o=this.editorConfig.lineHeight;if(this.activeComment){for(var r=0,a=this.iterateComments();r<a.length;r++){var m=a[r];if(m.state.comment.lineNumber!==this.activeComment.lineNumber||m.state.comment==this.activeComment&&!e||(t+=i.calculateNumberOfLines(m.state.comment.text)),m.state.comment==this.activeComment)break}n=t*o}return n+this.config.verticalOffset},e.prototype.layoutInlineToolbar=function(){var e=this;if(this.inlineToolbarElements.root.style.backgroundColor=this.getThemedColor("editor.background"),this.inlineToolbarElements.root.style.marginTop=this.calculateMarginTopOffset(!1)+"px",this.inlineToolbarElements.remove){var t=this.activeComment&&this.iterateComments((function(t){return t.comment.id===e.activeComment.id})).length>1,n=this.activeComment&&this.activeComment.author===this.currentUser;this.inlineToolbarElements.remove.style.display=t?"none":"",this.inlineToolbarElements.edit.style.display=t||!n?"none":""}this.editor.layoutContentWidget(this.widgetInlineToolbar)},e.prototype.layoutInlineCommentEditor=function(){var e=this;[this.editorElements.root,this.editorElements.textarea].forEach((function(t){t.style.backgroundColor=e.getThemedColor("editor.background"),t.style.color=e.getThemedColor("editor.foreground")})),[this.editorElements.confirm,this.editorElements.cancel].forEach((function(t){t.style.backgroundColor=e.getThemedColor("button.background"),t.style.color=e.getThemedColor("button.foreground")})),this.editorElements.confirm.innerText=this.editorMode===a.insertComment?"Add Comment":"Edit Comment",this.editorElements.root.style.marginTop=this.calculateMarginTopOffset(!0)+"px",this.editor.layoutContentWidget(this.widgetInlineCommentEditor)},e.prototype.setEditorMode=function(e){var t=this;this.editorMode=this.config.readOnly?a.toolbar:e,console.warn("setEditorMode",a[e],"Comment:",this.activeComment,"ReadOnly:",this.config.readOnly,"Result:",a[this.editorMode]),this.layoutInlineCommentEditor(),this.layoutInlineToolbar(),e!=a.insertComment&&e!=a.editComment||(e==a.insertComment?this.editorElements.textarea.value="":e==a.editComment&&(this.editorElements.textarea.value=this.activeComment?this.activeComment.text:""),setTimeout((function(){return t.editorElements.textarea.focus()}),100))},e.prototype.getDateTimeNow=function(){return new Date},e.prototype.recurseComments=function(e,t,n,o){for(var i=Object.values(e).filter(t),r=function(t){var i=t.comment;delete e[i.id],o.push({depth:n,state:t}),a.recurseComments(e,(function(e){return e.comment.parentId===i.id}),n+1,o)},a=this,m=0,s=i;m<s.length;m++){r(s[m])}},e.prototype.iterateComments=function(e){e||(e=function(e){return!e.comment.parentId});var t=o({},this.store.comments),n=[];return this.recurseComments(t,e,0,n),n},e.prototype.removeComment=function(e){return this.addEvent({type:"delete",targetId:e})},e.prototype.addComment=function(e,t,n){var o=this.editorMode===a.editComment?{type:"edit",text:t,targetId:this.activeComment.id}:{type:"create",text:t,lineNumber:e,selection:n,targetId:this.activeComment&&this.activeComment.id};return this.addEvent(o)},e.prototype.addEvent=function(e){return e.createdBy=this.currentUser,e.createdAt=this.getDateTimeNow(),e.id=m(),this.events.push(e),this.store=i.commentReducer(e,this.store),this.activeComment&&!this.store.comments[this.activeComment.id]?this.setActiveComment(null):this.activeComment&&this.activeComment.status===i.ReviewCommentStatus.deleted&&this.setActiveComment(null),this.refreshComments(),this.layoutInlineToolbar(),this.onChange&&this.onChange(this.events),e},e.prototype.formatDate=function(e){return this.config.formatDate?this.config.formatDate(e):e instanceof Date?e.toISOString():e},e.prototype.createElement=function(e,t,n){void 0===n&&(n=null);var o=document.createElement(n||"span");return o.className=t,o.innerText=e,o},e.prototype.getRenderState=function(e){return this.renderStore[e]||(this.renderStore[e]={viewZoneId:null,renderStatus:null}),this.renderStore[e]},e.prototype.refreshComments=function(){var e=this;this.editor.changeViewZones((function(t){for(var n,o={},r=0,a=Array.from(e.store.deletedCommentIds||[]);r<a.length;r++){var m=a[r],d=null===(n=e.renderStore[m])||void 0===n?void 0:n.viewZoneId;t.removeZone(d),e.verbose&&console.debug("Zone.Delete",d)}e.store.deletedCommentIds=null;for(var l=0,c=Array.from(e.store.dirtyCommentIds||[]);l<c.length;l++){m=c[l];e.getRenderState(m).renderStatus=i.ReviewCommentRenderState.dirty}e.store.dirtyCommentIds=null;for(var u=0,h=e.iterateComments();u<h.length;u++){var f=h[u],v=e.getRenderState(f.state.comment.id);if(v.renderStatus!==i.ReviewCommentRenderState.hidden){if(v.renderStatus===i.ReviewCommentRenderState.dirty&&(e.verbose&&console.debug("Zone.Dirty",f.state.comment.id),t.removeZone(v.viewZoneId),v.viewZoneId=null,v.renderStatus=i.ReviewCommentRenderState.normal),o[f.state.comment.lineNumber]||(o[f.state.comment.lineNumber]=f.state.comment.selection),null==v.viewZoneId){e.verbose&&console.debug("Zone.Create",f.state.comment.id);var C=e.activeComment==f.state.comment,p=e.createElement("","reviewComment "+(C?"active":" inactive"));p.style.marginLeft=e.config.commentIndent*(f.depth+1)+e.config.commentIndentOffset+"px",p.style.backgroundColor=e.getThemedColor("editor.selectionHighlightBackground"),p.appendChild(e.createElement((f.state.comment.author||" ")+" at ","reviewComment author")),p.appendChild(e.createElement(e.formatDate(f.state.comment.dt),"reviewComment dt")),f.state.history.length>1&&p.appendChild(e.createElement("(Edited "+(f.state.history.length-1)+" times)","reviewComment history")),p.appendChild(e.createElement(""+f.state.comment.text,"reviewComment text","div")),v.viewZoneId=t.addZone({afterLineNumber:f.state.comment.lineNumber,heightInLines:f.state.numberOfLines,domNode:p,suppressMouseDown:!0})}}else e.verbose&&console.debug("Zone.Hidden",f.state.comment.id),t.removeZone(v.viewZoneId),v.viewZoneId=null}if(e.config.showInRuler){for(var g=[],b=0,y=Object.entries(o);b<y.length;b++){var w=y[b],E=w[0],x=w[1];g.push({range:new s.monaco.Range(E,0,E,0),options:{isWholeLine:!0,overviewRuler:{color:e.config.rulerMarkerColor,darkColor:e.config.rulerMarkerDarkColor,position:1}}}),x&&g.push({range:new s.monaco.Range(x.startLineNumber,x.startColumn,x.endLineNumber,x.endColumn),options:{className:"reviewComment selection"}})}e.currentCommentDecorations=e.editor.deltaDecorations(e.currentCommentDecorations,g)}}))},e.prototype.addActions=function(){var e=this;this.editor.addAction({id:"my-unique-id-add",label:"Add Comment",keybindings:[s.monaco.KeyMod.CtrlCmd|s.monaco.KeyCode.F10],precondition:"add-context-key",keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:0,run:function(){e.setEditorMode(a.insertComment)}}),this.editor.addAction({id:"my-unique-id-next",label:"Next Comment",keybindings:[s.monaco.KeyMod.CtrlCmd|s.monaco.KeyCode.F12],precondition:null,keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:.101,run:function(){e.navigateToComment(r.next)}}),this.editor.addAction({id:"my-unique-id-prev",label:"Prev Comment",keybindings:[s.monaco.KeyMod.CtrlCmd|s.monaco.KeyCode.F11],precondition:null,keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:.102,run:function(){e.navigateToComment(r.prev)}})},e.prototype.navigateToComment=function(e){var t=0;t=this.activeComment?this.activeComment.lineNumber:this.editor.getPosition().lineNumber;var n=Object.values(this.store.comments).map((function(e){return e.comment})).filter((function(n){if(!n.parentId){if(e===r.next)return n.lineNumber>t;if(e===r.prev)return n.lineNumber<t}}));if(n.length){n.sort((function(t,n){return e===r.next?t.lineNumber-n.lineNumber:e===r.prev?n.lineNumber-t.lineNumber:void 0}));var o=n[0];this.setActiveComment(o),this.refreshComments(),this.layoutInlineToolbar(),this.editor.revealLineInCenter(o.lineNumber)}},e}();t.ReviewManager=l},function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1);function r(e,t){var n=new Set,i=new Set,r=new Set;switch(e.type){case"edit":var d=t.comments[e.targetId];if(!d)break;d.comment=o(o({},d.comment),{author:e.createdBy,dt:e.createdAt,text:e.text}),d.history.push(d.comment),d.numberOfLines=a(e.text),n.add(d.comment.lineNumber),console.log("edit",e);break;case"delete":var l=t.comments[e.targetId];delete t.comments[e.targetId],i.add(l.comment.id),n.add(l.comment.lineNumber),console.log("delete",e);break;case"create":t.comments[e.id]||(t.comments[e.id]=new s({author:e.createdBy,dt:e.createdAt,id:e.id,lineNumber:e.lineNumber,selection:e.selection,text:e.text,parentId:e.targetId,status:m.active},a(e.text)),console.log("insert",e),n.add(e.lineNumber))}if(n.size)for(var c=0,u=Object.values(t.comments);c<u.length;c++){var h=u[c];n.has(h.comment.lineNumber)&&r.add(h.comment.id)}return o(o({},t),{dirtyCommentIds:r,deletedCommentIds:i})}function a(e){return e?e.split(/\r*\n/).length+1:1}t.commentReducer=r,t.calculateNumberOfLines=a;var m,s=function(e,t){this.numberOfLines=t,this.comment=e,this.history=[e]};t.ReviewCommentState=s,function(e){e[e.dirty=1]="dirty",e[e.hidden=2]="hidden",e[e.normal=3]="normal"}(t.ReviewCommentRenderState||(t.ReviewCommentRenderState={})),function(e){e[e.active=1]="active",e[e.deleted=2]="deleted",e[e.edit=3]="edit"}(m=t.ReviewCommentStatus||(t.ReviewCommentStatus={})),t.reduceComments=function(e,t){void 0===t&&(t=null),t=t||{comments:{}};for(var n=0,o=e;n<o.length;n++){var a=o[n];a.id||(a.id=i()),t=r(a,t)}return t}},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var o=new Uint8Array(16);e.exports=function(){return n(o),o}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},function(e,t){for(var n=[],o=0;o<256;++o)n[o]=(o+256).toString(16).substr(1);e.exports=function(e,t){var o=t||0,i=n;return[i[e[o++]],i[e[o++]],i[e[o++]],i[e[o++]],"-",i[e[o++]],i[e[o++]],"-",i[e[o++]],i[e[o++]],"-",i[e[o++]],i[e[o++]],"-",i[e[o++]],i[e[o++]],i[e[o++]],i[e[o++]],i[e[o++]],i[e[o++]]].join("")}}]);