var MonacoEditorCodeReview=function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([,function(e,t,n){"use strict";n.r(t),n.d(t,"v1",(function(){return v})),n.d(t,"v3",(function(){return x})),n.d(t,"v4",(function(){return N})),n.d(t,"v5",(function(){return T})),n.d(t,"NIL",(function(){return O})),n.d(t,"version",(function(){return S})),n.d(t,"validate",(function(){return a})),n.d(t,"stringify",(function(){return u})),n.d(t,"parse",(function(){return C}));var o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),i=new Uint8Array(16);function r(){if(!o)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o(i)}var s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var a=function(e){return"string"==typeof e&&s.test(e)},d=[],m=0;m<256;++m)d.push((m+256).toString(16).substr(1));var c,l,u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]).toLowerCase();if(!a(n))throw TypeError("Stringified UUID is invalid");return n},h=0,f=0;var v=function(e,t,n){var o=t&&n||0,i=t||new Array(16),s=(e=e||{}).node||c,a=void 0!==e.clockseq?e.clockseq:l;if(null==s||null==a){var d=e.random||(e.rng||r)();null==s&&(s=c=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==a&&(a=l=16383&(d[6]<<8|d[7]))}var m=void 0!==e.msecs?e.msecs:Date.now(),v=void 0!==e.nsecs?e.nsecs:f+1,C=m-h+(v-f)/1e4;if(C<0&&void 0===e.clockseq&&(a=a+1&16383),(C<0||m>h)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");h=m,f=v,l=a;var g=(1e4*(268435455&(m+=122192928e5))+v)%4294967296;i[o++]=g>>>24&255,i[o++]=g>>>16&255,i[o++]=g>>>8&255,i[o++]=255&g;var b=m/4294967296*1e4&268435455;i[o++]=b>>>8&255,i[o++]=255&b,i[o++]=b>>>24&15|16,i[o++]=b>>>16&255,i[o++]=a>>>8|128,i[o++]=255&a;for(var p=0;p<6;++p)i[o+p]=s[p];return t||u(i)};var C=function(e){if(!a(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};var g=function(e,t,n){function o(e,o,i,r){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof o&&(o=C(o)),16!==o.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var s=new Uint8Array(16+e.length);if(s.set(o),s.set(e,o.length),(s=n(s))[6]=15&s[6]|t,s[8]=63&s[8]|128,i){r=r||0;for(var a=0;a<16;++a)i[r+a]=s[a];return i}return u(s)}try{o.name=e}catch(e){}return o.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",o.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",o};function b(e){return 14+(e+64>>>9<<4)+1}function p(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function y(e,t,n,o,i,r){return p((s=p(p(t,e),p(o,r)))<<(a=i)|s>>>32-a,n);var s,a}function w(e,t,n,o,i,r,s){return y(t&n|~t&o,e,t,i,r,s)}function E(e,t,n,o,i,r,s){return y(t&o|n&~o,e,t,i,r,s)}function I(e,t,n,o,i,r,s){return y(t^n^o,e,t,i,r,s)}function M(e,t,n,o,i,r,s){return y(n^(t|~o),e,t,i,r,s)}var x=g("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){for(var t=[],n=32*e.length,o=0;o<n;o+=8){var i=e[o>>5]>>>o%32&255,r=parseInt("0123456789abcdef".charAt(i>>>4&15)+"0123456789abcdef".charAt(15&i),16);t.push(r)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[b(t)-1]=t;for(var n=1732584193,o=-271733879,i=-1732584194,r=271733878,s=0;s<e.length;s+=16){var a=n,d=o,m=i,c=r;n=w(n,o,i,r,e[s],7,-680876936),r=w(r,n,o,i,e[s+1],12,-389564586),i=w(i,r,n,o,e[s+2],17,606105819),o=w(o,i,r,n,e[s+3],22,-1044525330),n=w(n,o,i,r,e[s+4],7,-176418897),r=w(r,n,o,i,e[s+5],12,1200080426),i=w(i,r,n,o,e[s+6],17,-1473231341),o=w(o,i,r,n,e[s+7],22,-45705983),n=w(n,o,i,r,e[s+8],7,1770035416),r=w(r,n,o,i,e[s+9],12,-1958414417),i=w(i,r,n,o,e[s+10],17,-42063),o=w(o,i,r,n,e[s+11],22,-1990404162),n=w(n,o,i,r,e[s+12],7,1804603682),r=w(r,n,o,i,e[s+13],12,-40341101),i=w(i,r,n,o,e[s+14],17,-1502002290),o=w(o,i,r,n,e[s+15],22,1236535329),n=E(n,o,i,r,e[s+1],5,-165796510),r=E(r,n,o,i,e[s+6],9,-1069501632),i=E(i,r,n,o,e[s+11],14,643717713),o=E(o,i,r,n,e[s],20,-373897302),n=E(n,o,i,r,e[s+5],5,-701558691),r=E(r,n,o,i,e[s+10],9,38016083),i=E(i,r,n,o,e[s+15],14,-660478335),o=E(o,i,r,n,e[s+4],20,-405537848),n=E(n,o,i,r,e[s+9],5,568446438),r=E(r,n,o,i,e[s+14],9,-1019803690),i=E(i,r,n,o,e[s+3],14,-187363961),o=E(o,i,r,n,e[s+8],20,1163531501),n=E(n,o,i,r,e[s+13],5,-1444681467),r=E(r,n,o,i,e[s+2],9,-51403784),i=E(i,r,n,o,e[s+7],14,1735328473),o=E(o,i,r,n,e[s+12],20,-1926607734),n=I(n,o,i,r,e[s+5],4,-378558),r=I(r,n,o,i,e[s+8],11,-2022574463),i=I(i,r,n,o,e[s+11],16,1839030562),o=I(o,i,r,n,e[s+14],23,-35309556),n=I(n,o,i,r,e[s+1],4,-1530992060),r=I(r,n,o,i,e[s+4],11,1272893353),i=I(i,r,n,o,e[s+7],16,-155497632),o=I(o,i,r,n,e[s+10],23,-1094730640),n=I(n,o,i,r,e[s+13],4,681279174),r=I(r,n,o,i,e[s],11,-358537222),i=I(i,r,n,o,e[s+3],16,-722521979),o=I(o,i,r,n,e[s+6],23,76029189),n=I(n,o,i,r,e[s+9],4,-640364487),r=I(r,n,o,i,e[s+12],11,-421815835),i=I(i,r,n,o,e[s+15],16,530742520),o=I(o,i,r,n,e[s+2],23,-995338651),n=M(n,o,i,r,e[s],6,-198630844),r=M(r,n,o,i,e[s+7],10,1126891415),i=M(i,r,n,o,e[s+14],15,-1416354905),o=M(o,i,r,n,e[s+5],21,-57434055),n=M(n,o,i,r,e[s+12],6,1700485571),r=M(r,n,o,i,e[s+3],10,-1894986606),i=M(i,r,n,o,e[s+10],15,-1051523),o=M(o,i,r,n,e[s+1],21,-2054922799),n=M(n,o,i,r,e[s+8],6,1873313359),r=M(r,n,o,i,e[s+15],10,-30611744),i=M(i,r,n,o,e[s+6],15,-1560198380),o=M(o,i,r,n,e[s+13],21,1309151649),n=M(n,o,i,r,e[s+4],6,-145523070),r=M(r,n,o,i,e[s+11],10,-1120210379),i=M(i,r,n,o,e[s+2],15,718787259),o=M(o,i,r,n,e[s+9],21,-343485551),n=p(n,a),o=p(o,d),i=p(i,m),r=p(r,c)}return[n,o,i,r]}(function(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(b(t)),o=0;o<t;o+=8)n[o>>5]|=(255&e[o/8])<<o%32;return n}(e),8*e.length))}));var N=function(e,t,n){var o=(e=e||{}).random||(e.rng||r)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=o[i];return t}return u(o)};function R(e,t,n,o){switch(e){case 0:return t&n^~t&o;case 1:return t^n^o;case 2:return t&n^t&o^n&o;case 3:return t^n^o}}function A(e,t){return e<<t|e>>>32-t}var T=g("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var o=unescape(encodeURIComponent(e));e=[];for(var i=0;i<o.length;++i)e.push(o.charCodeAt(i))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var r=e.length/4+2,s=Math.ceil(r/16),a=new Array(s),d=0;d<s;++d){for(var m=new Uint32Array(16),c=0;c<16;++c)m[c]=e[64*d+4*c]<<24|e[64*d+4*c+1]<<16|e[64*d+4*c+2]<<8|e[64*d+4*c+3];a[d]=m}a[s-1][14]=8*(e.length-1)/Math.pow(2,32),a[s-1][14]=Math.floor(a[s-1][14]),a[s-1][15]=8*(e.length-1)&4294967295;for(var l=0;l<s;++l){for(var u=new Uint32Array(80),h=0;h<16;++h)u[h]=a[l][h];for(var f=16;f<80;++f)u[f]=A(u[f-3]^u[f-8]^u[f-14]^u[f-16],1);for(var v=n[0],C=n[1],g=n[2],b=n[3],p=n[4],y=0;y<80;++y){var w=Math.floor(y/20),E=A(v,5)+R(w,C,g,b)+p+t[w]+u[y]>>>0;p=b,b=g,g=A(C,30)>>>0,C=v,v=E}n[0]=n[0]+v>>>0,n[1]=n[1]+C>>>0,n[2]=n[2]+g>>>0,n[3]=n[3]+b>>>0,n[4]=n[4]+p>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]})),O="00000000-0000-0000-0000-000000000000";var S=function(e){if(!a(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReviewManager=t.createReviewManager=t.EditorMode=t.reduceComments=void 0;const o=n(3);Object.defineProperty(t,"reduceComments",{enumerable:!0,get:function(){return o.reduceComments}});const i=n(1),r=window;var s,a;!function(e){e[e.next=1]="next",e[e.prev=2]="prev"}(s||(s={})),function(e){e[e.insertComment=1]="insertComment",e[e.editComment=2]="editComment",e[e.toolbar=3]="toolbar"}(a=t.EditorMode||(t.EditorMode={})),t.createReviewManager=function(e,t,n,o,i,r){const s=new m(e,t,o,i,r);return s.load(n||[]),s};const d={commentIndent:20,commentIndentOffset:20,editButtonAddText:"Reply",editButtonEditText:"Edit",editButtonEnableEdit:!0,editButtonEnableRemove:!0,editButtonOffset:"-10px",editButtonRemoveText:"Remove",formatDate:null,readOnly:!1,rulerMarkerColor:"darkorange",rulerMarkerDarkColor:"darkorange",showAddCommentGlyph:!0,showInRuler:!0,verticalOffset:0};class m{constructor(e,t,n,o,i){this.currentUser=t,this.editor=e,this.activeComment=null,this.widgetInlineToolbar=null,this.widgetInlineCommentEditor=null,this.onChange=n,this.editorMode=a.toolbar,this.config=Object.assign(Object.assign({},d),o||{}),this.currentLineDecorations=[],this.currentCommentDecorations=[],this.currentLineDecorationLineNumber=null,this.events=[],this.store={comments:{}},this.renderStore={},this.verbose=i,this.editorConfig=this.editor.getRawOptions(),this.editor.onDidChangeConfiguration(()=>this.editorConfig=this.editor.getRawOptions()),this.editor.onMouseDown(this.handleMouseDown.bind(this)),this.canAddCondition=this.editor.createContextKey("add-context-key",!this.config.readOnly),this.inlineToolbarElements=this.createInlineToolbarWidget(),this.editorElements=this.createInlineEditorWidget(),this.addActions(),this.config.showAddCommentGlyph&&this.editor.onMouseMove(this.handleMouseMove.bind(this))}setReadOnlyMode(e){this.config.readOnly=e,this.canAddCondition.set(e),this.renderAddCommentLineDecoration(null)}load(e){const t=o.reduceComments(e);this.loadFromStore(t,e)}loadFromStore(e,t){this.editor.changeViewZones(n=>{for(const e of Object.values(this.store.comments)){const t=this.getRenderState(e.comment.id);t&&null!==t.viewZoneId&&n.removeZone(t.viewZoneId)}this.events=t,this.store=e,this.store.deletedCommentIds=null,this.store.dirtyCommentIds=null,this.renderStore={},this.refreshComments(),this.verbose&&console.debug("Events Loaded:",t.length,"Review Comments:",Object.values(this.store.comments).length)})}getThemedColor(e){const t=this.editor._themeService.getTheme();let n=t.getColor(e);return n||(n={dark:{"button.background":"#0e639c","button.foreground":"#ffffff"},light:{"button.background":"#007acc","button.foreground":"#ffffff"}}[t.themeName.indexOf("dark")>-1?"dark":"light"][e]),n}createInlineEditButtonsElement(){var e=document.createElement("div");e.className="editButtonsContainer",e.style.marginLeft=this.config.editButtonOffset;const t=document.createElement("span");t.innerText=this.config.editButtonAddText,t.className="editButton add",t.setAttribute("ReviewManagerControl",""),t.onclick=()=>this.setEditorMode(a.insertComment,"add-comment"),e.appendChild(t);let n=null,o=null,i=null;return this.config.editButtonEnableRemove&&(i=document.createElement("div"),i.innerText=" ",e.appendChild(i),n=document.createElement("span"),n.setAttribute("ReviewManagerControl",""),n.innerText=this.config.editButtonRemoveText,n.className="editButton remove",n.onclick=()=>this.activeComment&&this.removeComment(this.activeComment.id),e.appendChild(n)),this.config.editButtonEnableEdit&&(i=document.createElement("div"),i.innerText=" ",e.appendChild(i),o=document.createElement("span"),o.setAttribute("ReviewManagerControl",""),o.innerText=this.config.editButtonEditText,o.className="editButton edit",o.onclick=()=>this.setEditorMode(a.editComment,"edit"),e.appendChild(o)),{root:e,add:t,remove:n,edit:o}}handleCancel(){this.setEditorMode(a.toolbar,"cancel"),this.editor.focus()}handleAddComment(){const e=this.activeComment?this.activeComment.lineNumber:this.editor.getSelection().endLineNumber,t=this.editorElements.textarea.value,n=this.activeComment?null:this.editor.getSelection();this.addComment(e,t,n),this.setEditorMode(a.toolbar,"add-comment-1"),this.editor.focus()}handleTextAreaKeyDown(e){"Escape"===e.code?(this.handleCancel(),e.preventDefault(),console.info("preventDefault: Escape Key")):"Enter"===e.code&&e.ctrlKey&&(this.handleAddComment(),e.preventDefault(),console.info("preventDefault: ctrl+Enter"))}createInlineEditorElement(){var e=document.createElement("div");e.className="reviewCommentEditor";const t=document.createElement("textarea");t.setAttribute("ReviewManagerControl",""),t.className="reviewCommentEditor text",t.innerText="",t.style.resize="none",t.style.width="100%",t.name="text",t.onkeydown=this.handleTextAreaKeyDown.bind(this);const n=document.createElement("button");n.setAttribute("ReviewManagerControl",""),n.className="reviewCommentEditor save",n.style.fontFamily="Consolas",n.innerText="Add Comment",n.onclick=this.handleAddComment.bind(this);const o=document.createElement("button");return o.setAttribute("ReviewManagerControl",""),o.className="reviewCommentEditor cancel",o.innerText="Cancel",o.onclick=this.handleCancel.bind(this),e.appendChild(t),e.appendChild(o),e.appendChild(n),{root:e,confirm:n,cancel:o,textarea:t}}createInlineToolbarWidget(){const e=this.createInlineEditButtonsElement(),t=this;return this.widgetInlineToolbar={allowEditorOverflow:!0,getId:()=>"widgetInlineToolbar",getDomNode:()=>e.root,getPosition:()=>{if(t.activeComment&&t.editorMode==a.toolbar&&!t.config.readOnly)return{position:{lineNumber:t.activeComment.lineNumber,column:1},preference:[2]}}},this.editor.addContentWidget(this.widgetInlineToolbar),e}createInlineEditorWidget(){const e=this.createInlineEditorElement();return this.widgetInlineCommentEditor={allowEditorOverflow:!0,getId:()=>"widgetInlineEditor",getDomNode:()=>(console.log("getDomNode"),e.root),getPosition:()=>{if(this.editorMode==a.insertComment||this.editorMode==a.editComment){const e=this.editor.getPosition();return{position:{lineNumber:this.activeComment?this.activeComment.lineNumber:e.lineNumber+1,column:e.column},preference:[0]}}}},this.editor.addContentWidget(this.widgetInlineCommentEditor),e}setActiveComment(e){this.verbose&&console.debug("setActiveComment",e);const t=[];!this.activeComment||e&&this.activeComment.lineNumber===e.lineNumber||t.push(this.activeComment.lineNumber),e&&t.push(e.lineNumber),this.activeComment=e,t.length>0&&this.filterAndMapComments(t,e=>{this.renderStore[e.id].renderStatus=o.ReviewCommentRenderState.dirty})}filterAndMapComments(e,t){for(const n of Object.values(this.store.comments))e.indexOf(n.comment.lineNumber)>-1&&t(n.comment)}handleMouseMove(e){e.target&&e.target.position&&e.target.position.lineNumber&&(this.currentLineDecorationLineNumber=e.target.position.lineNumber,this.renderAddCommentLineDecoration(!0===this.config.readOnly?null:this.currentLineDecorationLineNumber))}renderAddCommentLineDecoration(e){const t=e?[{range:new r.monaco.Range(e,0,e,0),options:{marginClassName:"activeLineMarginClass",zIndex:100}}]:[];this.currentLineDecorations=this.editor.deltaDecorations(this.currentLineDecorations,t)}handleMouseDown(e){if(e.target.element.className&&e.target.element.className.indexOf("activeLineMarginClass")>-1)this.editor.setPosition({lineNumber:this.currentLineDecorationLineNumber,column:1}),this.setEditorMode(a.insertComment,"mouse-down-1");else if(!e.target.element.hasAttribute("ReviewManagerControl")){let t=null;if(e.target.detail&&null!==e.target.detail.viewZoneId)for(const n of Object.values(this.store.comments).map(e=>e.comment)){if(this.getRenderState(n.id).viewZoneId==e.target.detail.viewZoneId){t=n;break}}this.setActiveComment(t),this.refreshComments(),this.setEditorMode(a.toolbar,"mouse-down-2")}}calculateMarginTopOffset(e){let t=0,n=0;const o=this.editorConfig.lineHeight;if(this.activeComment){for(var i of this.iterateComments())if(i.state.comment.lineNumber!==this.activeComment.lineNumber||i.state.comment==this.activeComment&&!e||(t+=this.calculateNumberOfLines(i.state.comment.text)),i.state.comment==this.activeComment)break;n=t*o}return n+this.config.verticalOffset}layoutInlineToolbar(){if(this.inlineToolbarElements.root.style.backgroundColor=this.getThemedColor("editor.background"),this.inlineToolbarElements.root.style.marginTop=this.calculateMarginTopOffset(!1)+"px",this.inlineToolbarElements.remove){const e=this.activeComment&&this.iterateComments(e=>e.comment.id===this.activeComment.id).length>1,t=this.activeComment&&this.activeComment.author===this.currentUser;this.inlineToolbarElements.remove.style.display=e?"none":"",this.inlineToolbarElements.edit.style.display=e||!t?"none":""}this.editor.layoutContentWidget(this.widgetInlineToolbar)}layoutInlineCommentEditor(){[this.editorElements.root,this.editorElements.textarea].forEach(e=>{e.style.backgroundColor=this.getThemedColor("editor.background"),e.style.color=this.getThemedColor("editor.foreground")}),[this.editorElements.confirm,this.editorElements.cancel].forEach(e=>{e.style.backgroundColor=this.getThemedColor("button.background"),e.style.color=this.getThemedColor("button.foreground")}),this.editorElements.confirm.innerText=this.editorMode===a.insertComment?"Add Comment":"Edit Comment",console.log("layout",this.editorElements.root),this.editor.layoutContentWidget(this.widgetInlineCommentEditor)}setEditorMode(e,t=null){this.editorMode=this.config.readOnly?a.toolbar:e,console.log("setEditorMode",a[e],t,"Comment:",this.activeComment,"ReadOnly:",this.config.readOnly,"Result:",a[this.editorMode]),this.layoutInlineToolbar(),this.layoutInlineCommentEditor(),e!=a.insertComment&&e!=a.editComment||(e==a.insertComment?this.editorElements.textarea.value="":e==a.editComment&&(this.editorElements.textarea.value=this.activeComment?this.activeComment.text:""),setTimeout(()=>this.editorElements.textarea.focus(),100))}getDateTimeNow(){return new Date}recurseComments(e,t,n,o){const i=Object.values(e).filter(t);for(const t of i){const i=t.comment;delete e[i.id],o.push({depth:n,state:t}),this.recurseComments(e,e=>e.comment.parentId===i.id,n+1,o)}}iterateComments(e){e||(e=e=>!e.comment.parentId);const t=Object.assign({},this.store.comments),n=[];return this.recurseComments(t,e,0,n),n}removeComment(e){return this.addEvent({type:"delete",targetId:e})}addComment(e,t,n){const o=this.editorMode===a.editComment?{type:"edit",text:t,targetId:this.activeComment.id}:{type:"create",text:t,lineNumber:e,selection:n,targetId:this.activeComment&&this.activeComment.id};return this.addEvent(o)}addEvent(e){return e.createdBy=this.currentUser,e.createdAt=this.getDateTimeNow(),e.id=i.v4(),this.events.push(e),this.store=o.commentReducer(e,this.store),(this.activeComment&&!this.store.comments[this.activeComment.id]||this.activeComment&&this.activeComment.status===o.ReviewCommentStatus.deleted)&&this.setActiveComment(null),this.refreshComments(),this.layoutInlineToolbar(),this.onChange&&this.onChange(this.events),e}formatDate(e){return this.config.formatDate?this.config.formatDate(e):e instanceof Date?e.toISOString():e}createElement(e,t,n=null){const o=document.createElement(n||"span");return o.className=t,o.innerText=e,o}getRenderState(e){return this.renderStore[e]||(this.renderStore[e]={viewZoneId:null,renderStatus:null}),this.renderStore[e]}refreshComments(){this.editor.changeViewZones(e=>{var t;const n={};for(const n of Array.from(this.store.deletedCommentIds||[])){const o=null===(t=this.renderStore[n])||void 0===t?void 0:t.viewZoneId;e.removeZone(o),this.verbose&&console.debug("Zone.Delete",o)}this.store.deletedCommentIds=null;for(const e of Array.from(this.store.dirtyCommentIds||[]))this.getRenderState(e).renderStatus=o.ReviewCommentRenderState.dirty;this.store.dirtyCommentIds=null;for(const t of this.iterateComments()){const i=this.getRenderState(t.state.comment.id);if(i.renderStatus!==o.ReviewCommentRenderState.hidden){if(i.renderStatus===o.ReviewCommentRenderState.dirty&&(this.verbose&&console.debug("Zone.Dirty",t.state.comment.id),e.removeZone(i.viewZoneId),i.viewZoneId=null,i.renderStatus=o.ReviewCommentRenderState.normal),n[t.state.comment.lineNumber]||(n[t.state.comment.lineNumber]=t.state.comment.selection),null==i.viewZoneId){this.verbose&&console.debug("Zone.Create",t.state.comment.id);const n=this.activeComment==t.state.comment,o=this.createElement("","reviewComment "+(n?"active":" inactive"));o.style.marginLeft=this.config.commentIndent*(t.depth+1)+this.config.commentIndentOffset+"px",o.style.backgroundColor=this.getThemedColor("editor.selectionHighlightBackground"),o.appendChild(this.createElement((t.state.comment.author||" ")+" at ","reviewComment author")),o.appendChild(this.createElement(this.formatDate(t.state.comment.dt),"reviewComment dt")),t.state.history.length>1&&o.appendChild(this.createElement(`(Edited ${t.state.history.length-1} times)`,"reviewComment history")),o.appendChild(this.createElement(""+t.state.comment.text,"reviewComment text","div")),i.viewZoneId=e.addZone({afterLineNumber:t.state.comment.lineNumber,heightInLines:this.calculateNumberOfLines(t.state.comment.text),domNode:o,suppressMouseDown:!0})}}else this.verbose&&console.debug("Zone.Hidden",t.state.comment.id),e.removeZone(i.viewZoneId),i.viewZoneId=null}if(this.config.showInRuler){const e=[];for(const[t,o]of Object.entries(n))e.push({range:new r.monaco.Range(t,0,t,0),options:{isWholeLine:!0,overviewRuler:{color:this.config.rulerMarkerColor,darkColor:this.config.rulerMarkerDarkColor,position:1}}}),o&&e.push({range:new r.monaco.Range(o.startLineNumber,o.startColumn,o.endLineNumber,o.endColumn),options:{className:"reviewComment selection"}});this.currentCommentDecorations=this.editor.deltaDecorations(this.currentCommentDecorations,e)}})}calculateNumberOfLines(e){return e?e.split(/\r*\n/).length+1:1}addActions(){this.editor.addAction({id:"my-unique-id-add",label:"Add Comment",keybindings:[r.monaco.KeyMod.CtrlCmd|r.monaco.KeyCode.F10],precondition:"add-context-key",keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:0,run:()=>{this.setEditorMode(a.insertComment,"add-comment-x")}}),this.editor.addAction({id:"my-unique-id-next",label:"Next Comment",keybindings:[r.monaco.KeyMod.CtrlCmd|r.monaco.KeyCode.F12],precondition:null,keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:.101,run:()=>{this.navigateToComment(s.next)}}),this.editor.addAction({id:"my-unique-id-prev",label:"Prev Comment",keybindings:[r.monaco.KeyMod.CtrlCmd|r.monaco.KeyCode.F11],precondition:null,keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:.102,run:()=>{this.navigateToComment(s.prev)}})}navigateToComment(e){let t=0;t=this.activeComment?this.activeComment.lineNumber:this.editor.getPosition().lineNumber;const n=Object.values(this.store.comments).map(e=>e.comment).filter(n=>{if(!n.parentId){if(e===s.next)return n.lineNumber>t;if(e===s.prev)return n.lineNumber<t}});if(n.length){n.sort((t,n)=>e===s.next?t.lineNumber-n.lineNumber:e===s.prev?n.lineNumber-t.lineNumber:void 0);const t=n[0];this.setActiveComment(t),this.refreshComments(),this.layoutInlineToolbar(),this.editor.revealLineInCenter(t.lineNumber)}}}t.ReviewManager=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reduceComments=t.ReviewCommentStatus=t.ReviewCommentRenderState=t.ReviewCommentState=t.commentReducer=void 0;const o=n(1);function i(e,t){const n=new Set,o=new Set,i=new Set;let a=Object.assign({},t.comments);switch(e.type){case"edit":const t=a[e.targetId];if(!t)break;const i={comment:Object.assign(Object.assign({},t.comment),{author:e.createdBy,dt:e.createdAt,text:e.text}),history:t.history.concat(t.comment)};n.add(i.comment.lineNumber),console.debug("edit",e),a[e.targetId]=i;break;case"delete":const d=a[e.targetId];if(!d)break;delete a[e.targetId],o.add(d.comment.id),n.add(d.comment.lineNumber),console.debug("delete",e);break;case"create":a[e.id]||(a[e.id]=new r({author:e.createdBy,dt:e.createdAt,id:e.id,lineNumber:e.lineNumber,selection:e.selection,text:e.text,parentId:e.targetId,status:s.active}),console.debug("insert",e),n.add(e.lineNumber))}if(n.size)for(const e of Object.values(t.comments))n.has(e.comment.lineNumber)&&i.add(e.comment.id);return{comments:a,dirtyCommentIds:i,deletedCommentIds:o}}t.commentReducer=i;class r{constructor(e){this.comment=e,this.history=[e]}}var s;t.ReviewCommentState=r,function(e){e[e.dirty=1]="dirty",e[e.hidden=2]="hidden",e[e.normal=3]="normal"}(t.ReviewCommentRenderState||(t.ReviewCommentRenderState={})),function(e){e[e.active=1]="active",e[e.deleted=2]="deleted",e[e.edit=3]="edit"}(s=t.ReviewCommentStatus||(t.ReviewCommentStatus={})),t.reduceComments=function(e,t=null){t=t||{comments:{}};for(const n of e)n.id||(n.id=o.v4()),t=i(n,t);return t}}]);
//# sourceMappingURL=index-var-es2017.js.map